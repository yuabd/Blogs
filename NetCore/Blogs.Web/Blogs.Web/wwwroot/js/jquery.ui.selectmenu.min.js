(function(n){n.widget("ui.selectmenu",{getter:"value",version:"1.8",eventPrefix:"selectmenu",options:{transferClasses:!0,typeAhead:"sequential",style:"dropdown",positionOptions:{my:"left top",at:"left bottom",offset:null},width:null,menuWidth:null,handleWidth:26,maxHeight:null,icons:null,format:null,bgImage:function(){},wrapperElement:""},_create:function(){var t=this,i=this.options,u=this.element.attr("id")||"ui-selectmenu-"+Math.random().toString(16).slice(2,10),r;this.ids=[u+"-button",u+"-menu"];this._safemouseup=!0;this.newelement=n('<a class="'+this.widgetBaseClass+' ui-widget ui-state-default ui-corner-all" id="'+this.ids[0]+'" role="button" href="#" tabindex="0" aria-haspopup="true" aria-owns="'+this.ids[1]+'"><\/a>').insertAfter(this.element);this.newelement.wrap(i.wrapperElement);r=this.element.attr("tabindex");r&&this.newelement.attr("tabindex",r);this.newelement.data("selectelement",this.element);this.selectmenuIcon=n('<span class="'+this.widgetBaseClass+'-icon ui-icon"><\/span>').prependTo(this.newelement);this.newelement.prepend('<span class="'+t.widgetBaseClass+'-status" />');n('label[for="'+this.element.attr("id")+'"]').attr("for",this.ids[0]).bind("click.selectmenu",function(){return t.newelement[0].focus(),!1});this.newelement.bind("mousedown.selectmenu",function(n){return t._toggle(n,!0),i.style=="popup"&&(t._safemouseup=!1,setTimeout(function(){t._safemouseup=!0},300)),!1}).bind("click.selectmenu",function(){return!1}).bind("keydown.selectmenu",function(i){var r=!1;switch(i.keyCode){case n.ui.keyCode.ENTER:r=!0;break;case n.ui.keyCode.SPACE:t._toggle(i);break;case n.ui.keyCode.UP:i.altKey?t.open(i):t._moveSelection(-1);break;case n.ui.keyCode.DOWN:i.altKey?t.open(i):t._moveSelection(1);break;case n.ui.keyCode.LEFT:t._moveSelection(-1);break;case n.ui.keyCode.RIGHT:t._moveSelection(1);break;case n.ui.keyCode.TAB:r=!0;break;default:r=!0}return r}).bind("keypress.selectmenu",function(n){return t._typeAhead(n.which,"mouseup"),!0}).bind("mouseover.selectmenu focus.selectmenu",function(){i.disabled||n(this).addClass(t.widgetBaseClass+"-focus ui-state-hover")}).bind("mouseout.selectmenu blur.selectmenu",function(){i.disabled||n(this).removeClass(t.widgetBaseClass+"-focus ui-state-hover")});n(document).bind("mousedown.selectmenu",function(n){t.close(n)});this.element.bind("click.selectmenu",function(){t._refreshValue()}).bind("focus.selectmenu",function(){t.newelement&&t.newelement[0].focus()});i.width||(i.width=this.element.outerWidth());this.newelement.width(i.width);this.element.hide();this.list=n('<ul class="'+t.widgetBaseClass+'-menu ui-widget ui-widget-content" aria-hidden="true" role="listbox" aria-labelledby="'+this.ids[0]+'" id="'+this.ids[1]+'"><\/ul>').appendTo("body");this.list.wrap(i.wrapperElement);this.list.bind("keydown.selectmenu",function(i){var r=!1;switch(i.keyCode){case n.ui.keyCode.UP:i.altKey?t.close(i,!0):t._moveFocus(-1);break;case n.ui.keyCode.DOWN:i.altKey?t.close(i,!0):t._moveFocus(1);break;case n.ui.keyCode.LEFT:t._moveFocus(-1);break;case n.ui.keyCode.RIGHT:t._moveFocus(1);break;case n.ui.keyCode.HOME:t._moveFocus(":first");break;case n.ui.keyCode.PAGE_UP:t._scrollPage("up");break;case n.ui.keyCode.PAGE_DOWN:t._scrollPage("down");break;case n.ui.keyCode.END:t._moveFocus(":last");break;case n.ui.keyCode.ENTER:case n.ui.keyCode.SPACE:t.close(i,!0);n(i.target).parents("li:eq(0)").trigger("mouseup");break;case n.ui.keyCode.TAB:r=!0;t.close(i,!0);n(i.target).parents("li:eq(0)").trigger("mouseup");break;case n.ui.keyCode.ESCAPE:t.close(i,!0);break;default:r=!0}return r}).bind("keypress.selectmenu",function(n){return t._typeAhead(n.which,"focus"),!0}).bind("mousedown.selectmenu mouseup.selectmenu",function(){return!1});n(window).bind("resize.selectmenu",n.proxy(t._refreshPosition,this))},_init:function(){var t=this,i=this.options,u=[],s,r,f,o,h,c,e,l;for(this.element.find("option").each(function(){u.push({value:n(this).attr("value"),text:t._formatText(n(this).text()),selected:n(this).attr("selected"),disabled:n(this).attr("disabled"),classes:n(this).attr("class"),typeahead:n(this).attr("typeahead"),parentOptGroup:n(this).parent("optgroup"),bgImage:i.bgImage.call(n(this))})}),s=t.options.style=="popup"?" ui-state-active":"",this.list.html(""),r=0;r<u.length;r++)if(f=n('<li role="presentation"'+(u[r].disabled?' class="'+this.namespace+'-state-disabled"':"")+'><a href="#" tabindex="-1" role="option"'+(u[r].disabled?' aria-disabled="true"':"")+' aria-selected="false"'+(u[r].typeahead?' typeahead="'+u[r].typeahead+'"':"")+">"+u[r].text+"<\/a><\/li>").data("index",r).addClass(u[r].classes).data("optionClasses",u[r].classes||"").bind("mouseup.selectmenu",function(i){if(t._safemouseup&&!t._disabled(i.currentTarget)&&!t._disabled(n(i.currentTarget).parents("ul>li."+t.widgetBaseClass+"-group "))){var r=n(this).data("index")!=t._selectedIndex();t.index(n(this).data("index"));t.select(i);r&&t.change(i);t.close(i,!0)}return!1}).bind("click.selectmenu",function(){return!1}).bind("mouseover.selectmenu focus.selectmenu",function(i){n(i.currentTarget).hasClass(t.namespace+"-state-disabled")||(t._selectedOptionLi().addClass(s),t._focusedOptionLi().removeClass(t.widgetBaseClass+"-item-focus ui-state-hover"),n(this).removeClass("ui-state-active").addClass(t.widgetBaseClass+"-item-focus ui-state-hover"))}).bind("mouseout.selectmenu blur.selectmenu",function(){n(this).is(t._selectedOptionLi().selector)&&n(this).addClass(s);n(this).removeClass(t.widgetBaseClass+"-item-focus ui-state-hover")}),u[r].parentOptGroup.length?(o=t.widgetBaseClass+"-group-"+this.element.find("optgroup").index(u[r].parentOptGroup),this.list.find("li."+o).length?this.list.find("li."+o+":last ul").append(f):n(' <li role="presentation" class="'+t.widgetBaseClass+"-group "+o+(u[r].parentOptGroup.attr("disabled")?" "+this.namespace+'-state-disabled" aria-disabled="true"':'"')+'><span class="'+t.widgetBaseClass+'-group-label">'+u[r].parentOptGroup.attr("label")+"<\/span><ul><\/ul><\/li> ").appendTo(this.list).find("ul").append(f)):f.appendTo(this.list),i.icons)for(h in i.icons)f.is(i.icons[h].find)&&(f.data("optionClasses",u[r].classes+" "+t.widgetBaseClass+"-hasIcon").addClass(t.widgetBaseClass+"-hasIcon"),c=i.icons[h].icon||"",f.find("a:eq(0)").prepend('<span class="'+t.widgetBaseClass+"-item-icon ui-icon "+c+'"><\/span>'),u[r].bgImage&&f.find("span").css("background-image",u[r].bgImage));e=i.style=="dropdown";this.newelement.toggleClass(t.widgetBaseClass+"-dropdown",e).toggleClass(t.widgetBaseClass+"-popup",!e);this.list.toggleClass(t.widgetBaseClass+"-menu-dropdown ui-corner-bottom",e).toggleClass(t.widgetBaseClass+"-menu-popup ui-corner-all",!e).find("li:first").toggleClass("ui-corner-top",!e).end().find("li:last").addClass("ui-corner-bottom");this.selectmenuIcon.toggleClass("ui-icon-triangle-1-s",e).toggleClass("ui-icon-triangle-2-n-s",!e);i.transferClasses&&(l=this.element.attr("class")||"",this.newelement.add(this.list).addClass(l));i.style=="dropdown"?this.list.width(i.menuWidth?i.menuWidth:i.width):this.list.width(i.menuWidth?i.menuWidth:i.width-i.handleWidth);i.maxHeight?i.maxHeight<this.list.height()&&this.list.height(i.maxHeight):!i.format&&n(window).height()/3<this.list.height()&&(i.maxHeight=n(window).height()/3,this.list.height(i.maxHeight));this._optionLis=this.list.find("li:not(."+t.widgetBaseClass+"-group)");this.element.attr("disabled")===!0?this.disable():this.enable();this.index(this._selectedIndex());window.setTimeout(function(){t._refreshPosition()},200)},destroy:function(){this.element.removeData(this.widgetName).removeClass(this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").removeAttr("aria-disabled").unbind(".selectmenu");n(window).unbind(".selectmenu");n(document).unbind(".selectmenu");n("label[for="+this.newelement.attr("id")+"]").attr("for",this.element.attr("id")).unbind(".selectmenu");this.options.wrapperElement?(this.newelement.find(this.options.wrapperElement).remove(),this.list.find(this.options.wrapperElement).remove()):(this.newelement.remove(),this.list.remove());this.element.show();n.Widget.prototype.destroy.apply(this,arguments)},_typeAhead:function(t,i){var r=this,f=!1,u=String.fromCharCode(t).toUpperCase(),e;if(c=u.toLowerCase(),r.options.typeAhead=="sequential"){window.clearTimeout("ui.selectmenu-"+r.selectmenuId);e=typeof r._prevChar=="undefined"?"":r._prevChar.join("");function o(t,u,e){f=!0;n(t).trigger(i);typeof r._prevChar=="undefined"?r._prevChar=[e]:r._prevChar[r._prevChar.length]=e}this.list.find("li a").each(function(t){if(!f){var i=n(this).attr("typeahead")||n(this).text();i.indexOf(e+u)==0?o(this,t,u):i.indexOf(e+c)==0&&o(this,t,c)}});window.setTimeout(function(){r._prevChar=undefined},1e3,r)}else{r._prevChar||(r._prevChar=["",0]);f=!1;function s(t,u){f=!0;n(t).trigger(i);r._prevChar[1]=u}this.list.find("li a").each(function(t){if(!f){var i=n(this).text();(i.indexOf(u)==0||i.indexOf(c)==0)&&(r._prevChar[0]==u?r._prevChar[1]<t&&s(this,t):s(this,t))}});this._prevChar[0]=u}},_uiHash:function(){var t=this.index();return{index:t,option:n("option",this.element).get(t),value:this.element[0].value}},open:function(n){var t=this;this.newelement.attr("aria-disabled")!="true"&&(this._closeOthers(n),this.newelement.addClass("ui-state-active"),t.options.wrapperElement?this.list.parent().appendTo("body"):this.list.appendTo("body"),this.list.addClass(t.widgetBaseClass+"-open").attr("aria-hidden",!1).find("li:not(."+t.widgetBaseClass+"-group):eq("+this._selectedIndex()+") a")[0].focus(),this.options.style=="dropdown"&&this.newelement.removeClass("ui-corner-all").addClass("ui-corner-top"),this._refreshPosition(),this._trigger("open",n,this._uiHash()))},close:function(n,t){this.newelement.is(".ui-state-active")&&(this.newelement.removeClass("ui-state-active"),this.list.attr("aria-hidden",!0).removeClass(this.widgetBaseClass+"-open"),this.options.style=="dropdown"&&this.newelement.removeClass("ui-corner-top").addClass("ui-corner-all"),t&&this.newelement.focus(),this._trigger("close",n,this._uiHash()))},change:function(n){this.element.trigger("change");this._trigger("change",n,this._uiHash())},select:function(n){if(this._disabled(n.currentTarget))return!1;this._trigger("select",n,this._uiHash())},_closeOthers:function(t){n("."+this.widgetBaseClass+".ui-state-active").not(this.newelement).each(function(){n(this).data("selectelement").selectmenu("close",t)});n("."+this.widgetBaseClass+".ui-state-hover").trigger("mouseout")},_toggle:function(n,t){this.list.is("."+this.widgetBaseClass+"-open")?this.close(n,t):this.open(n)},_formatText:function(n){return this.options.format?this.options.format(n):n},_selectedIndex:function(){return this.element[0].selectedIndex},_selectedOptionLi:function(){return this._optionLis.eq(this._selectedIndex())},_focusedOptionLi:function(){return this.list.find("."+this.widgetBaseClass+"-item-focus")},_moveSelection:function(n,t){var r=parseInt(this._selectedOptionLi().data("index")||0,10),i=r+n;if(i<0&&(i=0),i>this._optionLis.size()-1&&(i=this._optionLis.size()-1),i===t)return!1;if(this._optionLis.eq(i).hasClass(this.namespace+"-state-disabled"))n>0?++n:--n,this._moveSelection(n,i);else return this._optionLis.eq(i).trigger("mouseup")},_moveFocus:function(n,t){var u,i,r;if(isNaN(n)?i=parseInt(this._optionLis.filter(n).data("index"),10):(u=parseInt(this._focusedOptionLi().data("index")||0,10),i=u+n),i<0&&(i=0),i>this._optionLis.size()-1&&(i=this._optionLis.size()-1),i===t)return!1;r=this.widgetBaseClass+"-item-"+Math.round(Math.random()*1e3);this._focusedOptionLi().find("a:eq(0)").attr("id","");this._optionLis.eq(i).hasClass(this.namespace+"-state-disabled")?(n>0?++n:--n,this._moveFocus(n,i)):this._optionLis.eq(i).find("a:eq(0)").attr("id",r).focus();this.list.attr("aria-activedescendant",r)},_scrollPage:function(n){var t=Math.floor(this.list.outerHeight()/this.list.find("li:first").outerHeight());t=n=="up"?-t:t;this._moveFocus(t)},_setOption:function(n,t){this.options[n]=t;n=="disabled"&&(this.close(),this.element.add(this.newelement).add(this.list)[t?"addClass":"removeClass"](this.widgetBaseClass+"-disabled "+this.namespace+"-state-disabled").attr("aria-disabled",t))},disable:function(n,t){typeof n=="undefined"?this._setOption("disabled",!0):t=="optgroup"?this._disableOptgroup(n):this._disableOption(n)},enable:function(n,t){typeof n=="undefined"?this._setOption("disabled",!1):t=="optgroup"?this._enableOptgroup(n):this._enableOption(n)},_disabled:function(t){return n(t).hasClass(this.namespace+"-state-disabled")},_disableOption:function(n){var t=this._optionLis.eq(n);t&&(t.addClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!0),this.element.find("option").eq(n).attr("disabled","disabled"))},_enableOption:function(n){var t=this._optionLis.eq(n);t&&(t.removeClass(this.namespace+"-state-disabled").find("a").attr("aria-disabled",!1),this.element.find("option").eq(n).removeAttr("disabled"))},_disableOptgroup:function(n){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+n);t&&(t.addClass(this.namespace+"-state-disabled").attr("aria-disabled",!0),this.element.find("optgroup").eq(n).attr("disabled","disabled"))},_enableOptgroup:function(n){var t=this.list.find("li."+this.widgetBaseClass+"-group-"+n);t&&(t.removeClass(this.namespace+"-state-disabled").attr("aria-disabled",!1),this.element.find("optgroup").eq(n).removeAttr("disabled"))},index:function(t){if(arguments.length){if(this._disabled(n(this._optionLis[t])))return!1;this.element[0].selectedIndex=t;this._refreshValue()}else return this._selectedIndex()},value:function(n){if(arguments.length)this.element[0].value=n,this._refreshValue();else return this.element[0].value},_refreshValue:function(){var t=this.options.style=="popup"?" ui-state-active":"",i=this.widgetBaseClass+"-item-"+Math.round(Math.random()*1e3),r,n;this.list.find("."+this.widgetBaseClass+"-item-selected").removeClass(this.widgetBaseClass+"-item-selected"+t).find("a").attr("aria-selected","false").attr("id","");this._selectedOptionLi().addClass(this.widgetBaseClass+"-item-selected"+t).find("a").attr("aria-selected","true").attr("id",i);r=this.newelement.data("optionClasses")?this.newelement.data("optionClasses"):"";n=this._selectedOptionLi().data("optionClasses")?this._selectedOptionLi().data("optionClasses"):"";this.newelement.removeClass(r).data("optionClasses",n).addClass(n).find("."+this.widgetBaseClass+"-status").html(this._selectedOptionLi().find("a:eq(0)").html());this.list.attr("aria-activedescendant",i)},_refreshPosition:function(){var n=this.options,t,r,i;n.style!="popup"||n.positionOptions.offset||(t=this._selectedOptionLi(),r="0 -"+(t.outerHeight()+t.offset().top-this.list.offset().top));i=this.element.zIndex();i&&this.list.css({zIndex:i});this.list.position({of:n.positionOptions.of||this.newelement,my:n.positionOptions.my,at:n.positionOptions.at,offset:n.positionOptions.offset||r,collision:n.positionOptions.collision||"flip"})}})})(jQuery);